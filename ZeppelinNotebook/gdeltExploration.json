{"paragraphs":[{"text":"%md\n## Exploration des donnees GDELT via Spark\nDans ce notebook nous allons commencer a explorer les donnees GDELT qu'on a stoque sur S3","user":"anonymous","dateUpdated":"2020-01-12T16:30:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Exploration des donnees GDELT via Spark</h2>\n<p>Dans ce notebook nous allons commencer a explorer les donnees GDELT qu&rsquo;on a stoque sur S3</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1578846632496_-244057136","id":"20181212-102323_67420128","dateCreated":"2020-01-12T16:30:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:296"},{"text":"val AWS_ID = \"ASIATATIKUDEEMHP3TFD\"\nval AWS_KEY = \"JlKz/1F+UUtygpPx/u8tTNIEdo1wqLBSGUnDZzX5\"\nval AWS_TOKEN = \"FwoGZXIvYXdzELj//////////wEaDKc/hKUDYWUDifkwDiLMAXUsxkT9ZoP+jZzbyPo0M5Li1oZJx385Vd0TdJj5gEcUyXGEYaCydwWE0oUKpHSFPvCt+nPgUUrFQFabuyNdx1/r4a4fTcDv4En9S2shBxUl83N0XBRJVU0muC5Y9k5DUYpztH3SbTgp94CywyE5Rqg455MwBjVht9VvvFBCSxlH3daW1ahD5tc2sxAIo/b1Yl36xG8mlUGnwxbYRftspFuPVK7ofgoas6kH2Ev9NRkU+eu+9cdl7EObIvW5g5GahCjVgeKGDntBZzK8PCj64+zwBTItK/TD9cR+2zKTfkyMPqW64HBonVQQp+r0a5/+EKN2EbZle5QV5isL+jnuemBJ\"\n\nsc.hadoopConfiguration.set(\"fs.s3a.aws.credentials.provider\", \"org.apache.hadoop.fs.s3a.TemporaryAWSCredentialsProvider\")\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.session.token\", AWS_TOKEN)","user":"anonymous","dateUpdated":"2020-01-12T17:29:05+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"AWS_ID: String = ASIATATIKUDEEMHP3TFD\nAWS_KEY: String = JlKz/1F+UUtygpPx/u8tTNIEdo1wqLBSGUnDZzX5\nAWS_TOKEN: String = FwoGZXIvYXdzELj//////////wEaDKc/hKUDYWUDifkwDiLMAXUsxkT9ZoP+jZzbyPo0M5Li1oZJx385Vd0TdJj5gEcUyXGEYaCydwWE0oUKpHSFPvCt+nPgUUrFQFabuyNdx1/r4a4fTcDv4En9S2shBxUl83N0XBRJVU0muC5Y9k5DUYpztH3SbTgp94CywyE5Rqg455MwBjVht9VvvFBCSxlH3daW1ahD5tc2sxAIo/b1Yl36xG8mlUGnwxbYRftspFuPVK7ofgoas6kH2Ev9NRkU+eu+9cdl7EObIvW5g5GahCjVgeKGDntBZzK8PCj64+zwBTItK/TD9cR+2zKTfkyMPqW64HBonVQQp+r0a5/+EKN2EbZle5QV5isL+jnuemBJ\n"}]},"apps":[],"jobName":"paragraph_1578846632499_-682961932","id":"20171217-230735_1688540039","dateCreated":"2020-01-12T16:30:32+0000","dateStarted":"2020-01-12T17:29:05+0000","dateFinished":"2020-01-12T17:29:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:297"},{"text":"%md Les fichiers sont stoquees compresses, on a besoin d'un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu'on les lit depuis S3:","user":"anonymous","dateUpdated":"2020-01-12T16:30:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>Les fichiers sont stoquees compresses, on a besoin d&rsquo;un bout de code pour les decompresser en parallel sur les workers au fur et a mesure qu&rsquo;on les lit depuis S3:</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1578846632499_-1741693666","id":"20181212-102329_808049084","dateCreated":"2020-01-12T16:30:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:298"},{"text":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\n// 20181201000000.export.CSV.zip\nval textRDD = sc.binaryFiles(\"s3://gael-sav-telecom-gdelt2019-new/20181201000000.export.CSV.zip\"). // charger quelques fichers via une regex\n   flatMap {  // decompresser les fichiers\n       case (name: String, content: PortableDataStream) =>\n          val zis = new ZipInputStream(content.open)\n          Stream.continually(zis.getNextEntry).\n                takeWhile(_ != null).\n                flatMap { _ =>\n                    val br = new BufferedReader(new InputStreamReader(zis))\n                    Stream.continually(br.readLine()).takeWhile(_ != null)\n                }\n    }\ntextRDD.take(1)\n","user":"anonymous","dateUpdated":"2020-01-12T17:35:14+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.input.PortableDataStream\nimport java.util.zip.ZipInputStream\nimport java.io.BufferedReader\nimport java.io.InputStreamReader\ntextRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[46] at flatMap at <console>:55\nres31: Array[String] = Array(806754250\t20171201\t201712\t2017\t2017.9068\t\t\t\t\t\t\t\t\t\t\tUSA\tUNITED STATES\tUSA\t\t\t\t\t\t\t\t1\t100\t100\t10\t3\t-5.0\t4\t1\t4\t-0.66666666666667\t0\t\t\t\t\t\t\t\t3\tNew Haven, Connecticut, United States\tUS\tUSCT\t\t41.3082\t-72.9282\t209231\t3\tNew Haven, Connecticut, United States\tUS\tUSCT\t\t41.3082\t-72.9282\t209231\t20181201000000\thttps://bismarcktribune.com/news/national/the-latest-immigrant-s-supporters-end-courthouse-protest/article_76d71ef6-d0e0-5e02-ab72-4c8a0d31778e.html)\n"}]},"apps":[],"jobName":"paragraph_1578846632499_-355754698","id":"20171217-232457_1732696781","dateCreated":"2020-01-12T16:30:32+0000","dateStarted":"2020-01-12T17:35:14+0000","dateFinished":"2020-01-12T17:35:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:299"},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578850476832_-320214791","id":"20200112-173436_1194086373","dateCreated":"2020-01-12T17:34:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1178","text":"val textDF = textRDD.toDF","dateUpdated":"2020-01-12T17:38:30+0000","dateFinished":"2020-01-12T17:38:31+0000","dateStarted":"2020-01-12T17:38:30+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"textDF: org.apache.spark.sql.DataFrame = [value: string]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578850847224_-747155442","id":"20200112-174047_1337021457","dateCreated":"2020-01-12T17:40:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1408","text":"textDF.show(1)","dateUpdated":"2020-01-12T17:41:09+0000","dateFinished":"2020-01-12T17:41:20+0000","dateStarted":"2020-01-12T17:41:09+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+\n|               value|\n+--------------------+\n|806754250\t2017120...|\n+--------------------+\nonly showing top 1 row\n\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578850475444_189213109","id":"20200112-173435_1739300072","dateCreated":"2020-01-12T17:34:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1106","text":"val textDFColRenamed = textDF.withColumn(\"_tmp\", split($\"value\", \"\\\\t\")).select(\n  $\"_tmp\".getItem(0).as(\"GLOBALEVENTID\"),\n  $\"_tmp\".getItem(1).as(\"SQLDATE\"),\n  $\"_tmp\".getItem(2).as(\"MonthYear\"),\n  $\"_tmp\".getItem(3).as(\"Year\")\n  // continue\n).drop(\"_tmp\")\n","dateUpdated":"2020-01-12T17:52:26+0000","dateFinished":"2020-01-12T17:52:26+0000","dateStarted":"2020-01-12T17:52:26+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"textDFColRenamed: org.apache.spark.sql.DataFrame = [GLOBALEVENTID: string, SQLDATE: string ... 2 more fields]\n"}]}},{"user":"anonymous","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1578851494159_1645975282","id":"20200112-175134_1278341667","dateCreated":"2020-01-12T17:51:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1862","text":"textDFColRenamed.show(2)","dateUpdated":"2020-01-12T17:52:29+0000","dateFinished":"2020-01-12T17:52:40+0000","dateStarted":"2020-01-12T17:52:29+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------+--------+---------+----+\n|GLOBALEVENTID| SQLDATE|MonthYear|Year|\n+-------------+--------+---------+----+\n|    806754250|20171201|   201712|2017|\n|    806754251|20171201|   201712|2017|\n+-------------+--------+---------+----+\nonly showing top 2 rows\n\n"}]}},{"text":"%md A vous de jouer ! Utilisez la documentation GDELT(https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/) et commencez a explorer les donnees via les API Spark.","user":"anonymous","dateUpdated":"2020-01-12T16:30:32+0000","config":{"tableHide":false,"editorSetting":{"language":"markdown","editOnDblClick":true,"completionKey":"TAB","completionSupport":false},"colWidth":12,"editorMode":"ace/mode/markdown","fontSize":9,"editorHide":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<p>A vous de jouer ! Utilisez la documentation GDELT(<a href=\"https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/\">https://blog.gdeltproject.org/gdelt-2-0-our-global-world-in-realtime/</a>) et commencez a explorer les donnees via les API Spark.</p>\n</div>"}]},"apps":[],"jobName":"paragraph_1578846632500_1510985293","id":"20171218-084519_765381887","dateCreated":"2020-01-12T16:30:32+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:301"}],"name":"gdeltExploration_corrected","id":"2EZZUX3DY","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}